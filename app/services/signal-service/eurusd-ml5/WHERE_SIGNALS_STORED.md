# Where Signals Are Stored

## Database Location

**Database:** `algo_trader`  
**Table:** `ml_signal_history`  
**Schema:** PostgreSQL

All signals generated by the service are saved to this database table.

## View Signals in Database

### View Latest Signal
```bash
sudo -u postgres psql -d algo_trader -c "SELECT instrument, direction, confidence, ml_probability, entry_price, timestamp, valid_until FROM ml_signal_history ORDER BY timestamp DESC LIMIT 1;"
```

### View All Signals
```bash
sudo -u postgres psql -d algo_trader -c "SELECT * FROM ml_signal_history ORDER BY timestamp DESC LIMIT 10;"
```

### View All EUR/USD Signals
```bash
sudo -u postgres psql -d algo_trader -c "SELECT id, direction, confidence, ml_probability, entry_price, timestamp FROM ml_signal_history WHERE instrument = 'EUR_USD' ORDER BY timestamp DESC;"
```

### Count Total Signals
```bash
sudo -u postgres psql -d algo_trader -c "SELECT COUNT(*) FROM ml_signal_history;"
```

## Interactive Database Query

Connect to database:
```bash
sudo -u postgres psql -d algo_trader
```

Then run SQL queries:
```sql
-- View latest signal
SELECT * FROM ml_signal_history ORDER BY timestamp DESC LIMIT 1;

-- View all EUR/USD signals
SELECT * FROM ml_signal_history WHERE instrument = 'EUR_USD' ORDER BY timestamp DESC;

-- View signals with indicators (JSONB)
SELECT 
    id,
    instrument,
    direction,
    confidence,
    ml_probability,
    entry_price,
    indicators->>'rsi' as rsi,
    indicators->>'atr' as atr,
    timestamp
FROM ml_signal_history 
WHERE instrument = 'EUR_USD' 
ORDER BY timestamp DESC 
LIMIT 5;
```

## Log Files

**Location:** `/home/myalgo/algo-trader/app/services/signal-service/eurusd-ml5/logs/`

**Format:** `eurusd_ml5_signal_service_YYYYMMDD.log`

View logs:
```bash
tail -f /home/myalgo/algo-trader/app/services/signal-service/eurusd-ml5/logs/eurusd_ml5_signal_service_*.log
```

## Signal Data Structure

Each signal contains:
- **id** - UUID
- **instrument** - "EUR_USD"
- **direction** - "BUY", "SELL", or "NEUTRAL"
- **confidence** - "HIGH", "MEDIUM", or "LOW"
- **ml_probability** - 0.0 to 1.0
- **entry_price** - Price at signal generation
- **indicators** - JSONB with all technical indicators (RSI, MACD, ATR, etc.)
- **individual_models** - JSONB with each model's prediction
- **timestamp** - When signal was generated
- **valid_until** - When signal expires

## Access from Code

```python
from app.db.db import get_db
from app.models.ml_signal_history import MLSignalHistory
from datetime import datetime, timezone

# Get latest signal
async for db in get_db():
    latest = db.query(MLSignalHistory).filter(
        MLSignalHistory.instrument == "EUR_USD"
    ).order_by(MLSignalHistory.timestamp.desc()).first()
    
    if latest:
        print(f"Latest signal: {latest.direction} ({latest.confidence})")
```

